<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Create your own test · PermutationTests</title><meta name="title" content="Create your own test · PermutationTests"/><meta property="og:title" content="Create your own test · PermutationTests"/><meta property="twitter:title" content="Create your own test · PermutationTests"/><meta name="description" content="Documentation for PermutationTests."/><meta property="og:description" content="Documentation for PermutationTests."/><meta property="twitter:description" content="Documentation for PermutationTests."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img class="docs-light-only" src="../assets/logo.png" alt="PermutationTests logo"/><img class="docs-dark-only" src="../assets/logo-dark.png" alt="PermutationTests logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">PermutationTests</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">PermutationTests.jl</a></li><li><a class="tocitem" href="../about/">About</a></li><li><a class="tocitem" href="../PermutationTests/">Main Module</a></li><li><a class="tocitem" href="../univariate tests/">Univariate tests</a></li><li><a class="tocitem" href="../multiple comparisons tests/">Multiple comparisons tests</a></li><li><a class="tocitem" href="../package tests/">Package tests</a></li><li><a class="tocitem" href="../tools/">Tools</a></li><li><span class="tocitem">Extras</span><ul><li><a class="tocitem" href="../statistics/">Statistics</a></li><li><a class="tocitem" href="../test statistics/">Test statistics</a></li><li class="is-active"><a class="tocitem" href>Create your own test</a><ul class="internal"><li><a class="tocitem" href="#Using-existing-tests"><span>Using existing tests</span></a></li><li><a class="tocitem" href="#Defining-new-test-statistics"><span>Defining new test statistics</span></a></li></ul></li><li><a class="tocitem" href="../chose a test/">Chose a Test</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Extras</a></li><li class="is-active"><a href>Create your own test</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Create your own test</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Marco-Congedo/PermutationTests.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/master/docs/src/create your own test.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Create-your-own-test"><a class="docs-heading-anchor" href="#Create-your-own-test">Create your own test</a><a id="Create-your-own-test-1"></a><a class="docs-heading-anchor-permalink" href="#Create-your-own-test" title="Permalink"></a></h1><p>This page illustrates how you can create <em>univariate</em> and <em>multiple comparisons</em> permutation tests besides those already supported by <em>PermutationsTests.jl</em>.</p><p>Good knowledge and understanding of the whole documentation is required for continuing reading this page, including the <strong>Extras</strong> pages.</p><p>There are two ways you can extend the capability of <em>PermutationTests.jl</em>.</p><ul><li><p>The first, very simple, but limited, is by using existing tests with particular data input.</p></li><li><p>The second, which needs some development, but is much more general, allows you to create new tests defining your own test statistics.</p></li></ul><h2 id="Using-existing-tests"><a class="docs-heading-anchor" href="#Using-existing-tests">Using existing tests</a><a id="Using-existing-tests-1"></a><a class="docs-heading-anchor-permalink" href="#Using-existing-tests" title="Permalink"></a></h2><p>The approach is illustrated by creating tests for the autocorrelation, which are not in the API of the package.</p><p><strong>Example of a univariate permutation test</strong></p><p>As an example, let us detect the presence of autocorrelation at lag 1, similar to what the  <a href="https://en.wikipedia.org/wiki/Durbin%E2%80%93Watson_statistic">Durbin-Watson test</a> does.</p><p><em>PermutationTests.jl</em> implements the Pearson product moment correlation statistic and a test for it. We can then test the null hypothesis that the autocorrelation at lag 1 is equal to zero by performing a correlation test on a data vector <code>x</code> and a lagged version of itself <code>y</code>.</p><p>This is simply achieved by calling the <a href="#PermutationTests._permTest!"><code>_permTest!</code></a>, which performs all  <a href="../univariate tests/#Univariate-tests">univariate tests</a> implemented in the package:</p><pre><code class="language-julia hljs">using PermutationTests
# First, let us create some data autorrelated at lag 1 as example
N=300
data=randn(N)
for i=2:length(data)
  data[i-1]=data[i-1]+data[i]
end

# Data and lagged version of the data
x=data[1:end-1]
y=data[2:end]

# Our Univariate test on autocorrelation
t=_permTest!(copy(x), y, N-1, PearsonR(), PearsonR())
# NB: we pass a copy of x as this vector will be permuted.</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_5" style="color:#ff8700">
⚅ Univariate Permutation test
</span>p-value = &lt;0.001
<span class="sgr90">⚁      ⚁      ⚂      ⚃      ⚁      ⚃      ⚄      ⚁      ⚄      ⚀      ⚀      
</span><span class="sgr38_5" style="color:#ffd7af">.p </span><span class="sgr90">(p-value) </span><span class="sgr38_5" style="color:#ffd7af">.stat </span><span class="sgr90">(test statistic)</span><span class="sgr38_5" style="color:#ffd7af">.obsstat </span><span class="sgr90">  (observed statistic)
</span><span class="sgr38_5" style="color:#ffd7af">.minp </span><span class="sgr90"> (minimum attainable p-value)</span><span class="sgr38_5" style="color:#ffd7af">.nperm </span><span class="sgr90">(number of permutations)
</span><span class="sgr38_5" style="color:#ffd7af">.testtype </span><span class="sgr90"> (exact or approximated)</span><span class="sgr38_5" style="color:#ffd7af">.direction </span><span class="sgr90">(Both, Left or Right)
</span><span class="sgr38_5" style="color:#ffd7af">.design </span><span class="sgr90"> (Balanced or Unbalanced)
</span></code></pre><p>The testing procedure can be further improved and refined, see for example <a href="../univariate tests/#PermutationTests.correlationTest"><code>correlationTest</code></a>, but this should suffice to give the idea.</p><hr/><p><strong>Example of a multiple comparison permutation test</strong></p><p>Similarly, we can easily test simultaneously the autocorrelation at several lags with a  multiple comparison version of the above test.</p><p>This is achieved by calling the <a href="#PermutationTests._permMcTest!"><code>_permMcTest!</code></a>, which performs all  <a href="../multiple comparisons tests/#Multiple-comparisons-tests">multiple comparisons tests</a> implemented in the package. Now we craete a vector <code>x</code> and a vector <code>Y</code> holding as many lagged versions of <code>x</code> as we wish to test:</p><pre><code class="language-julia hljs">using PermutationTests
# Let us create some data autorrelated at lag 1 and 2 as example
N=300
data=randn(N)
for j=1:2, i=2:length(data)
  data[i-1]=data[i-1]+data[i]
end

# We will test lags 1 to 30
lags=1:30
x=data[1:end-length(lags)]
Y=[data[l+1:end-length(lags)+l] for l in lags]

# Our muliple comparisons test on autocorrelations
tMc=_permMcTest!(copy(x), Y, N-length(lags), PearsonR(), PearsonR())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_5" style="color:#ff8700">
⚀ ⚀ ⚂ ... Multiple Comparison Permutation test
</span>Rejected 2 out of 30 hypotheses (6.67 %) in 1 step with FWE=0.05
<span class="sgr90">⚅      ⚄      ⚂      ⚂      ⚂      ⚄      ⚄      ⚂      ⚄      ⚁      ⚀      
</span><span class="sgr38_5" style="color:#ffd7af">.p </span><span class="sgr90">(p-values)</span><span class="sgr38_5" style="color:#ffd7af">.stat </span><span class="sgr90">(test statistic)</span><span class="sgr38_5" style="color:#ffd7af">.obsstat </span><span class="sgr90"> (observed statistics)
</span><span class="sgr38_5" style="color:#ffd7af">.minp </span><span class="sgr90"> (minimum attainable p-value)</span><span class="sgr38_5" style="color:#ffd7af">.nperm </span><span class="sgr90">(number of permutations)
</span><span class="sgr38_5" style="color:#ffd7af">.testtype </span><span class="sgr90"> (exact or approximated)</span><span class="sgr38_5" style="color:#ffd7af">.direction </span><span class="sgr90">(Both, Left or Right)
</span><span class="sgr38_5" style="color:#ffd7af">.design </span><span class="sgr90"> (Balanced or Unbalanced)
</span><span class="sgr38_5" style="color:#ffd7af">.nulldistr </span><span class="sgr90">  (null distribution)</span><span class="sgr38_5" style="color:#ffd7af">.rejections </span><span class="sgr90">(for each step down)
</span><span class="sgr38_5" style="color:#ffd7af">.stepdown </span><span class="sgr90">   (true if stepdown)</span><span class="sgr38_5" style="color:#ffd7af">.fwe </span><span class="sgr90">(family-wise err. stepdown)
</span></code></pre><p>The p-values are retrived by </p><pre><code class="language-julia hljs">tMc.p # p-values for lags 1...30 </code></pre><p>Notice that the test above is different from the  <a href="https://en.wikipedia.org/wiki/Ljung%E2%80%93Box_test">Liung-Box test</a>, which is a multivariate test for a group of lags: with a multiple comparison tests we have tested each lag in the group <em>simultaneously</em>, controlling the family-wise error (FWE) rate at the nominal level (0.05 by default). Thus on the base of the p-values  <em>we can take a decision on the null hypothesis at each lag</em>.</p><p>You can check yourself that the test controls the FWE rate at the nominal level by running the test above with random Gaussian data many times and controlling  that the proportion of rejections, which are false by definition since random Gaussian data is not autocorrelated, does not exceed the nominal level.</p><hr/><h2 id="Defining-new-test-statistics"><a class="docs-heading-anchor" href="#Defining-new-test-statistics">Defining new test statistics</a><a id="Defining-new-test-statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-new-test-statistics" title="Permalink"></a></h2><p>You can create your own permutation tests based on a <em>custom test statistic</em> as long as the permutation scheme  for your test is supported by <em>PermutationTests.jl</em>. Four permutation schemes are implemented in the package, corresponding to four implemented groups of test-statistics. Before continuing, read the documentation of <a href="../tools/#PermutationTests.genPerms"><code>genPerms</code></a> and the documentation linked therein.</p><p>In order to create a test you will call function <a href="#PermutationTests._permTest!"><code>_permTest!</code></a>(univariate)  or <a href="#PermutationTests._permMcTest!"><code>_permMcTest!</code></a>(multiple comaprisons). You will pass, among others, argument <code>asStat</code>, which determines the permutation scheme of the test.</p><div class="admonition is-success"><header class="admonition-header">keep in mind</header><div class="admonition-body"><p>The <code>asStat</code> argument can be one of the following built-in test statistics or any test statistic belonging to the same <a href="../PermutationTests/#Statistic-groups">group</a>:</p><ul><li><code>PearsonR()</code></li><li><code>AnovaF_IS()</code></li><li><code>AnovaF_RM()</code></li><li><code>StudentT_1S()</code></li></ul></div></div><p>The procedure to follow is slightly different depending on whether you want  to create your own univariate or multiple comparisons test.</p><hr/><h4 id="UNIVARIATE-TESTS"><a class="docs-heading-anchor" href="#UNIVARIATE-TESTS">UNIVARIATE TESTS</a><a id="UNIVARIATE-TESTS-1"></a><a class="docs-heading-anchor-permalink" href="#UNIVARIATE-TESTS" title="Permalink"></a></h4><p>Creating your own univariate test involves two preliminary steps:</p><ol><li>define a new <a href="../PermutationTests/#Statistic"><code>Statistic</code></a> type to name the test statistic you want to use</li><li>write a method for the <a href="../test statistics/#PermutationTests.statistic"><code>statistic</code></a> function to compute the test statistic for both the observed and permuted data</li></ol><p>You then obtain the test just calling the <a href="#PermutationTests._permTest!"><code>_permTest!</code></a> functions, as we will show.</p><div class="admonition is-success"><header class="admonition-header">keep in mind</header><div class="admonition-body"><p>Argument <code>fstat</code> of <code>_permTest!</code> by default is the <code>abs</code> julia function, which yields a bi-directional test.  If appropriate for the test statistic at hand, use <code>fstat=identity</code> for a right-directional test and  <code>fstat=</code><a href="#PermutationTests.flip"><code>flip</code></a> for a left-directional test. </p></div></div><hr/><p><strong>Example of a univariate permutation test</strong></p><p>We create a new test for the difference of the mean between two independent samples. Such a test is equivalent to the <em>Student&#39;s t-test for independent samples</em>, since the mean difference is the nominator of the t statistic and the denominator is invariant with respect to data permutation.</p><p>The permutations scheme is the same as the permutation scheme of the <code>AnovaF_IS()</code> (or <code>StudentT_IS</code>)  test statistic, hence it is supported by <em>PermutationTests.jl</em> and we can reuse it.</p><pre><code class="language-julia hljs"># First, let us import `statistic` from PermutationTests.jl
using PermutationTests
import PermutationTests: statistic

# 1) define a new `Statistic` type to name the test statistic you want to use
struct MeanDiff &lt;: Statistic end

#=
2) write a method for the `statistic` function to compute the mean difference,
it does not matter if the data is observed or permuted.
We must input the data exactly as for the `AnovaF_IS()` statistic.

Our observations are divided in two groups. In this case,
ror this and equivalent statistics, data input is given as a single vector
y of length N1+N2, with the N1 observations followed by the N2 observations.

The `statistic` method also takes as input a &#39;membership&#39; vector x,
holding 1 for subjects of group 1 and 2 for subjects of group 2,
that is, x=[repeat ([1], N1); repeat([2], N2)].
When given as input, x will reflect the positioning of the observed data
and for permuted data it will be a permutation thereof.

A simple implementation:
=#
function statistic(x, y, stat::MeanDiff; kwargs...)
    # get the number of subjects in each gruoup
    ns=[count(j-&gt;j==i, x) for i=1:length(unique(x))]

    s=[0., 0.]
    @simd for i ∈ eachindex(x, y)
        @inbounds (s[x[i]] += y[i])
    end
    return (s[1]/ns[1]) - (s[2]/ns[2]) # mean difference
end

#=
The following code block is not necessary.
We report it to illustrate a nice opportunity you have to write
efficient code to compute test statistics;
the above implementation computes the group numerosity (ns=[N1, N2])
at each permutation, however ns is invariant to permutations.

Let us rewrite the function then using the `cpcd` argument,
which will be passed to the `_permTest!` functions in order to
(optionally) pre-compute `ns`.
=#
function statistic(x, y, stat::MeanDiff; cpcd=nothing, kwargs...)
    if cpcd===nothing
        ns=[count(j-&gt;j==i, x) for i=1:length(unique(x))]
    else
        ns=cpcd
    end

    s=[0., 0.]
    @simd for i ∈ eachindex(x, y)
        @inbounds (s[x[i]] += y[i])
    end
    return (s[1]/ns[1]) - (s[2]/ns[2]) # mean difference
end

# That&#39;s it. Let&#39;s test our own test:

# create some data
y=[4., 5., 6., 7., 1., 2., 3]
ns=[4, 3] # N1=4, N2=3

# membership vector (the dedicated function `membership` is available)
x=membership(StudentT_IS(), ns) # = [repeat ([1], N1); repeat([2], N2)]

println(&quot;t-test independent samples (bi-directional) using PermutationsTest.jl: &quot;);
# two-directional exact test. Equivalent to API function studentTestIS(y, ns)
t1 = _permTest!(copy(x), y, ns, StudentT_IS(), StudentT_IS())
# Note: we pass a copy of x as this vector will be permuted.

# This runs the test we have created. Note that argument `stat` of `_permTest!`
# is `MeanDiff()`, while argument `asStat` is `AnovaF_IS()`
println(&quot;t-test independent samples (bi-directional) using our own statistic: &quot;);
t2 = _permTest!(copy(x), y, ns, MeanDiff(), AnovaF_IS())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_5" style="color:#ff8700">
⚃ Univariate Permutation test
</span>p-value = 0.057
<span class="sgr90">⚂      ⚂      ⚁      ⚀      ⚂      ⚁      ⚁      ⚅      ⚀      ⚀      ⚃      
</span><span class="sgr38_5" style="color:#ffd7af">.p </span><span class="sgr90">(p-value) </span><span class="sgr38_5" style="color:#ffd7af">.stat </span><span class="sgr90">(test statistic)</span><span class="sgr38_5" style="color:#ffd7af">.obsstat </span><span class="sgr90">  (observed statistic)
</span><span class="sgr38_5" style="color:#ffd7af">.minp </span><span class="sgr90"> (minimum attainable p-value)</span><span class="sgr38_5" style="color:#ffd7af">.nperm </span><span class="sgr90">(number of permutations)
</span><span class="sgr38_5" style="color:#ffd7af">.testtype </span><span class="sgr90"> (exact or approximated)</span><span class="sgr38_5" style="color:#ffd7af">.direction </span><span class="sgr90">(Both, Left or Right)
</span><span class="sgr38_5" style="color:#ffd7af">.design </span><span class="sgr90"> (Balanced or Unbalanced)
</span></code></pre><p>As before, but using the <code>cpcd</code> argument to avoid redundant computations:</p><pre><code class="language-julia hljs">t2_ = _permTest!(copy(x), y, ns, MeanDiff(), StudentT_IS(); cpcd=ns) </code></pre><p>You can check that the p-values obtained by the two tests is identical:</p><pre><code class="language-julia hljs">t1.p≈t2.p ? (@info &quot;my test works!&quot;) : 
            (@error &quot;my test does not work!&quot; t1.p t2.p)</code></pre><p>To run a right-directional test:</p><pre><code class="language-julia hljs">t3 = _permTest!(copy(x), y, ns, MeanDiff(), StudentT_IS(); fstat = identity)</code></pre><p>To run a left-directional approximate test (see <a href="#PermutationTests._permTest!"><code>_permTest!</code></a>):</p><pre><code class="language-julia hljs">t4 = _permTest!(copy(x), y, ns, MeanDiff(), StudentT_IS(); fstat = flip, switch2rand=1)</code></pre><p>etc.</p><hr/><h4 id="MULTIPLE-COMPARISON-TESTS"><a class="docs-heading-anchor" href="#MULTIPLE-COMPARISON-TESTS">MULTIPLE COMPARISON TESTS</a><a id="MULTIPLE-COMPARISON-TESTS-1"></a><a class="docs-heading-anchor-permalink" href="#MULTIPLE-COMPARISON-TESTS" title="Permalink"></a></h4><p>Creating your own multiple comparison test involves three preliminary steps:</p><ol><li>define a new <a href="../PermutationTests/#Statistic"><code>Statistic</code></a> type to name the test statistic you want to use</li><li>write a method of the <a href="#PermutationTests._observedStats"><code>_observedStats</code></a> function to compute function <code>fstat</code> of all observed test-statistics at once as a vector</li><li>write a method of the <a href="#PermutationTests._permutedStat"><code>_permutedStat</code></a> function to compute function <code>fstat</code> of each permutation statistics separately </li></ol><p>You then obtain the test just calling the <a href="#PermutationTests._permMcTest!"><code>_permMcTest!</code></a> functions.</p><div class="admonition is-success"><header class="admonition-header">keep in mind</header><div class="admonition-body"><p>Argument <code>fstat</code> of <code>_permMcTest!</code> by default is the <code>abs</code> julia function, which yields a bi-directional test.  If appropriate for the test statistic at hand, use <code>fstat=identity</code> for a right-directional test and  <code>fstat=</code><a href="#PermutationTests.flip"><code>flip</code></a> for a left-directional test. </p></div></div><hr/><p><strong>Example of a multiple comparison permutation test</strong></p><p>We create another version of the Pearson product-moment correlation test between a fixed variable given as a vector <code>x</code> and  <span>$M$</span> variables given as a vector of <span>$M$</span> vectors <code>Y</code>. We want to test simultaneously  all correlations between <code>x</code> and <code>Y[m]</code>, for <span>$m=1...M$</span>.</p><p>The permutations scheme is the one of the <code>PearsonR()</code> statistic, hence it is supported by <em>PermutationTests.jl</em> and we can reuse it (as <code>asStat</code> argument of <code>_permMcTest!</code>).</p><pre><code class="language-julia hljs"># First, let us import some names from PermutationTests.jl
using PermutationTests
import PermutationTests: statistic, _observedStats, _permutedStat

using LinearAlgebra: dot, ⋅ # we are going to use the dot product

# 1) Define a new `Statistic` type to name the test statistic you want to use
struct MyPearsonR &lt;: Statistic end

#=
2) Write a function to compute function `fstat` of all observed
test-statistics at once as a vector.

In order to obtain a faster test we will work with standardized
variables, thus the Pearson correlation is given simply by the
cross-product divided by N.

Note that we will subtract a small constant to all
obseved statistics (sqrt(eps())) to avoid numerical errors when
comparing the observed statistics to the permuted statistics.
=#
_observedStats(x, Y, stat::MyPearsonR, fstat::Function=abs; kwargs...) =
    [fstat((x ⋅ y)/length(x)) - sqrt(eps()) for y ∈ Y]

#=
3) Write a function to compute function `fstat` of the mth
permuted test-statistic.

Again, we will work with standardized variables, thus the Pearson
correlation is given simply by the cross-product divided by N.
=#
_permutedStat(x, Y, m::Int, stat::MyPearsonR, fstat::Function=abs; kwargs...) =
    fstat((x ⋅ Y[m])/length(x))


# That&#39;s it. Let&#39;s test our own test:

# Let&#39;s create some data as example
N, M = 7, 100 # N=7 observations, M=100 hypotheses
x=randn(N);
Y=[randn(N) for m=1:M];

println(&quot;correlation test using PermutationsTest.jl: &quot;);
# Exact test. Equivalent to API function rMcTest!(x, Y)
# NB: the standardization function μ0σ1() is exported by PermutationTests.jl
t1 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y ∈ Y], length(x), PearsonR(), PearsonR())

println(&quot;correlation test using our own test: &quot;);
t2 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y ∈ Y], length(x), MyPearsonR(), PearsonR())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr38_5" style="color:#ff8700">
⚁ ⚃ ⚂ ... Multiple Comparison Permutation test
</span>Rejected 0 out of 100 hypotheses (0.0 %) in 1 step with FWE=0.05
<span class="sgr90">⚄      ⚄      ⚀      ⚀      ⚃      ⚅      ⚂      ⚅      ⚁      ⚃      ⚃      
</span><span class="sgr38_5" style="color:#ffd7af">.p </span><span class="sgr90">(p-values)</span><span class="sgr38_5" style="color:#ffd7af">.stat </span><span class="sgr90">(test statistic)</span><span class="sgr38_5" style="color:#ffd7af">.obsstat </span><span class="sgr90"> (observed statistics)
</span><span class="sgr38_5" style="color:#ffd7af">.minp </span><span class="sgr90"> (minimum attainable p-value)</span><span class="sgr38_5" style="color:#ffd7af">.nperm </span><span class="sgr90">(number of permutations)
</span><span class="sgr38_5" style="color:#ffd7af">.testtype </span><span class="sgr90"> (exact or approximated)</span><span class="sgr38_5" style="color:#ffd7af">.direction </span><span class="sgr90">(Both, Left or Right)
</span><span class="sgr38_5" style="color:#ffd7af">.design </span><span class="sgr90"> (Balanced or Unbalanced)
</span><span class="sgr38_5" style="color:#ffd7af">.nulldistr </span><span class="sgr90">  (null distribution)</span><span class="sgr38_5" style="color:#ffd7af">.rejections </span><span class="sgr90">(for each step down)
</span><span class="sgr38_5" style="color:#ffd7af">.stepdown </span><span class="sgr90">   (true if stepdown)</span><span class="sgr38_5" style="color:#ffd7af">.fwe </span><span class="sgr90">(family-wise err. stepdown)
</span></code></pre><p>Check that the p-values obtained by the two tests is identical:</p><pre><code class="language-julia hljs">abs(sum(t1.p-t2.p))&lt;1e-8 ?  (@info &quot;my test works!&quot;) : 
                            (@error &quot;my test does not work!&quot;)</code></pre><p>Check also the observed statistics:</p><pre><code class="language-julia hljs">abs(sum(t1.obsstat-t2.obsstat))&lt;1e-8 ?  (@info &quot;my test works!&quot;) : 
                                        (@error &quot;my test does not work!&quot;)</code></pre><p>To run a right-directional test:</p><pre><code class="language-julia hljs">t3 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y ∈ Y], length(x), MyPearsonR(), PearsonR(); 
        fstat = identity) </code></pre><p>To run a left-directional approximate test:</p><pre><code class="language-julia hljs">t4 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y ∈ Y], length(x), MyPearsonR(), PearsonR(); 
        fstat = identity, switch2rand=1)</code></pre><hr/><p>We can also pre-compute data that is invariant to permutations in order to obtain  a faster procedure. </p><p>For example, suppose we didn&#39;t know that the cross-product  divided by <code>N</code> is equal to the Pearson statistic when the data is standardized.  Instead of computing the Pearson statistics each time from scratch at each permutation,  we could still pre-compute the means and standard deviations, which are invariant  to pemutations, using the <code>cpcd</code> (custom pre-computed data) keyword argument, such as:</p><pre><code class="language-julia hljs"># Pre-compute means and standard deviations. Here you can compute anything you need
# NB: the mean μ() and st. deviation function σ(y) are exported by PermutationTests.jl 
cpcd=[μ(x), [μ(y) for y in Y], σ(x), [σ(y) for y in Y]]</code></pre><p>Declare functions for observed and permuted data using argument cpcd. Note that</p><ul><li><code>_observedStats</code> computes all <span>$M$</span> statistics, while <code>_permutedStat</code> computes the <span>$m^{th}$</span> statistic.</li><li>not the statistics, but function <code>fstat</code> of the statistics are returned</li></ul><pre><code class="language-julia hljs">_observedStats(x, Y, stat::MyPearsonR, fstat::Function=abs; cpcd=cpcd, kwargs...) = 
    [fstat( (((x.-cpcd[1])./cpcd[3]) ⋅ ((y.-cpcd[2][m])./cpcd[4][m])) / length(x) ) - 
        sqrt(eps()) for (m, y) ∈ enumerate(Y)]

_permutedStat(x, Y, m::Int, stat::MyPearsonR, fstat::Function=abs; cpcd=cpcd, kwargs...) = 
    fstat((((x.-cpcd[1])./cpcd[3]) ⋅ ((Y[m].-cpcd[2][m])./cpcd[4][m])) / length(x))</code></pre><pre><code class="language-julia hljs">println(&quot;correlation test using my own test and pre-computed data: &quot;);
t2_ = _permMcTest!(copy(x), Y, length(x), MyPearsonR(), PearsonR(); cpcd=cpcd) </code></pre><p>Note that we copy <code>x</code> because otherwise, using this permutation scheme, it is overwritten. If you don&#39;t care, you can simply pass <code>x</code>. </p><div class="admonition is-info"><header class="admonition-header">nota bene</header><div class="admonition-body"><p>If you reuse the permutations scheme given with  <code>asStat=StudentT_1S()</code>, <code>x</code> or <code>Y</code> are overwritten, depending on whether the test is exact or approximated. </p></div></div><p>Note also that now running the <code>_permMcTest!</code> function without the <code>cpcd</code> kwarg gives an error, since we did not implement versions of <code>_observedStats</code> and of <code>_permutedStat</code>  that take it as an optional argument (although we could, as we have done for the univariate test). </p><hr/><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests._permTest!" href="#PermutationTests._permTest!"><code>PermutationTests._permTest!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function _permTest!(x::UniData, y::UniData, ns::nsType, stat::Stat, asStat::AsStat;
                    standardized::Bool=false, centered::Bool=false, 
                    nperm::Int = 20000, 
                    fstat::Function = abs,
                    compfunc::Function = &gt;=,
                    switch2rand::Int = Int(1e8),
                    seed::Int = 1234,
                    verbose::Bool = true,
                    cpcd = nothing) where {Stat&lt;:Statistic, AsStat&lt;:Statistic}</code></pre><p>This function ultimately performs all <strong>univariate permutation tests</strong> implemented in <em>PermutationsTests.jl</em>,  both <em>exact</em> and <em>approximate</em> (Monte Carlo). </p><p>For running tests use the <a href="../univariate tests/#Univariate-tests">univariate test functions</a>. You need this function only for <a href="#Create-your-own-test">creating your own tests</a>.</p><p>Rewrite <code>x</code> and/or <code>y</code>, depending on the test performed.</p><p>For the <code>ns</code> argument see <a href="../tools/#ns">ns</a>.</p><p><code>stat</code> can be a singleton of the <a href="../PermutationTests/#Statistic">Statistic</a> type or a user-defined singleton of this type  to be used as argument of a function implemented by the user to compute both the observed and permuted test statistics, see <a href="#Create-your-own-test">create your own test</a>.</p><p><code>asStat</code> is a singleton of the <a href="../PermutationTests/#Statistic">Statistic</a> type. It is used to determine the permutation scheme  and for this purpose it will be passed to <a href="../tools/#PermutationTests.genPerms"><code>genPerms</code></a> and <a href="../tools/#PermutationTests.nrPerms"><code>nrPerms</code></a>.</p><p><code>asStat</code> determines also the input data format if you declare your own <code>stat</code> type. In this case the function you write for computing the observed and permuted test statistic will take the <code>x</code> and  <code>y</code> arguments as it follows: </p><p>For <code>Stat</code> belonging to <a href="../PermutationTests/#Statistic-groups">group</a></p><ul><li><code>BivStatistic</code> : <code>x</code>, <code>y</code> are the two vectors of <span>$N$</span> elements each for which the bivariate statistic is to be tested. <code>ns</code> is ignored.</li><li><code>IndSampStatistic</code> : we have <span>$K$</span> groups and <span>$N=N_1+...+N_K$</span> total observations; <code>y</code> holds all observations in a single vector such as <code>[y1;...;yK]</code> and <code>x</code> is the <a href="#PermutationTests.membership"><code>membership(::IndSampStatistic)</code></a> vector. For example, for <span>$K=2$</span>, <span>$N_1=2$</span> and <span>$N_2=3$</span>, <code>x=[1, 1, 2, 2, 2]</code>.</li><li><code>RepMeasStatistic</code> : we have <span>$K$</span> measures (<em>e.g.</em>, treatements) and <span>$N$</span> subjects; <code>y</code> holds the  <span>$K*N$</span> observations in a single vector such as <code>[y1;...;yN]</code>, where each vector <span>$y_i$</span>, for <span>$i=1...N$</span>, holds the observation at the <span>$K$</span> treatments and <code>x=collect(1:K*N)</code> (see <a href="#PermutationTests.membership"><code>membership(::RepMeasStatistic)</code></a>).</li><li><code>OneSampStatistic</code> : We have <span>$N$</span> observations (<em>e.g.</em>, subjects); <code>y</code> holds the <span>$N$</span> observations and <code>x=ones(Int, N)</code> (see <a href="#PermutationTests.membership"><code>membership(::OneSampStatistic)</code></a>).</li></ul><p>For <code>length(x)&gt;30</code> the approximate test is performed in all cases, </p><p>otherwise,</p><p>if the number of systematic permutations exceeds <code>switch2rand</code> the approximate test is performed  using <code>nperm</code> random permutations (default 20000), </p><p>otherwise, </p><p>the exact test is performed. </p><p><code>switch2rand</code> defaults to 1e8.  To perform approximate tests in all cases, set <code>switch2rand</code>, for example, to 1. </p><p>If <code>stat</code> is a <code>BivStatistic</code>, it optionally uses kwargs <code>standardized</code> or <code>centered</code> to compute them faster, see for example <a href="../univariate tests/#PermutationTests.correlationTest"><code>correlationTest</code></a>.</p><p><code>seed</code> is the initial seed for generating random permutations (not used for exact tests).  To use a random seed, pass <code>seed=0</code>. For <code>seed</code> any natural number, the test will be reproducible.</p><p><code>fstat</code> is a function applied to the test statistic. By default this is the julia <code>abs</code> function,  which takes the absolute value, hence yieds a bi-directional test.  For a right-directional test pass here <code>identity</code>.  For a left-directional test pass here <a href="#PermutationTests.flip"><code>flip</code></a>.</p><p><code>compfunc</code> is the function to compare the observed statistics to the permuted statistics.  The default function is <code>&gt;=</code>. Don&#39;t change it.</p><p>If <code>verbose</code> is true, print some information in the REPL while running the test.  Set to false if you run benchmarks. The default is true.</p><p>For the <code>cpcd</code> argument, see <a href="#Create-your-own-test">create you own test</a>.</p><p>Return a <a href="../PermutationTests/#UniTest">UniTest</a> structure.</p><p><em>Examples</em></p><pre><code class="language-julia hljs">using PermutationTests
x=randn(6)
y=randn(6) 
# bi-directional exact test of the correlation between x and y
t8 = _permTest!(μ0(x), μ0(y), length(x), Covariance(), Covariance(); centered=true) 
t8.p
t8.stat
#...

# make a left-directional test and standardize the data
t8_2 = _permTest!(μ0σ1(x), μ0σ1(y), length(x), Covariance(), Covariance(); 
        standardized=true, fstat=flip) 

# the same but force an approximate test
t8_3 = _permTest!(μ0σ1(x), μ0σ1(y), length(x), Covariance(), Covariance(); 
        standardized=true, fstat=flip, switch2rand=1) 

# the same using 5000 random permutations
t8_4 = _permTest!(μ0σ1(x), μ0σ1(y), length(x), Covariance(), Covariance(); 
        standardized=true, fstat=flip, switch2rand=1, nperm=5000) </code></pre><p>To check more examples, see the <em>uniTests_API.jl</em> unit located in the <em>src</em> github folder and function <code>test_unitests()</code> in the <em>runtests.jl</em> unit located in the <em>test</em> github folder.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/uniTests.jl#L63-L165">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests._permMcTest!" href="#PermutationTests._permMcTest!"><code>PermutationTests._permMcTest!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function _permMcTest!(x::UniData, Y::UniDataVec, ns::nsType, stat::Stat, asStat::AsStat;
            standardized::Bool=false, centered::Bool=false, 
            stepdown::Bool = true,
            fwe::Float64 = 0.05,
            nperm::Int = 20000, 
            fstat::Function = abs,
            compfunc::Function = &gt;=,
            switch2rand::Int = Int(1e8),
            seed::Int = 1234,
            threaded::Bool = Threads.nthreads()&gt;=4,
            verbose::Bool = true,
            cpcd = nothing) where {Stat&lt;:Statistic, AsStat&lt;:Statistic}</code></pre><p>This function ultimately performs all <strong>multiple comparisons permutation tests</strong> implemented in <em>PermutationsTests.jl</em>,  both <em>exact</em> and <em>approximate</em> (Monte Carlo). </p><p>For running tests use the <a href="../multiple comparisons tests/#Multiple-comparisons-tests">multiple comparisons test functions</a>. You need this function only for <a href="#Create-your-own-test">creating your own tests</a>.</p><p>The step-down version of the test is performed if <code>stepdown</code> is true (default). In this case the <code>fwe</code> (family-wise error) rate is used for rejection at each step (default=0.05).</p><p>Rewrite <code>x</code> and/or <code>Y</code>, depending on the test performed.</p><p>For the <code>ns</code> argument see <a href="../tools/#ns">ns</a>.</p><p><code>stat</code> can be a singleton of the <a href="../PermutationTests/#Statistic">Statistic</a> type or a user-defined singleton of this type  to be used as argument of two functions implemented by the user to compute the observed and permuted test statistics, see <a href="#Create-your-own-test">create your own test</a>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>In contrast to univariate tests, equivalent statistics are not possible for multiple comparison tests,  with the exception of <code>CrossProd()</code> if the data has been standardized and <code>Covariance()</code> if the data  has been centered and those only for correlation-like tests.</p><p>The test statistics that must be used as <code>Stat</code> for the other kinds of test if a singleton of the  <a href="../PermutationTests/#Statistic">Statistic</a> type is used are <code>AnovaF_IS()</code>, <code>StudentT_IS()</code>, <code>AnovaF_RM()</code>, and <code>StudentT_1S()</code>.</p></div></div><p><code>asStat</code> is a singleton of the <a href="../PermutationTests/#Statistic">Statistic</a> type. It is used to determine the permutation scheme  and for this purpose it will be passed to <a href="../tools/#PermutationTests.genPerms"><code>genPerms</code></a> and <a href="../tools/#PermutationTests.nrPerms"><code>nrPerms</code></a>.</p><p><code>asStat</code> determines also the input data format if you declare your own <code>stat</code> type. In this case the two functions you write for computing the observed and permuted statistics will take the <code>x</code> and  <code>Y</code> arguments as it follows. </p><p>For <code>Stat</code> belonging to <a href="../PermutationTests/#Statistic-groups">group</a></p><ul><li><code>BivStatistic</code> : <code>x</code> is a fixed vector with <span>$N$</span> elements and <code>Y</code> an an <span>$M$</span>-vector of <span>$N$</span>-vectors. The <span>$M$</span> bivariate statistics between <code>x</code> and the <span>$y_m$</span> vectors of <code>Y</code> are tested simultaneously. <code>ns</code> is ignored.</li><li><code>IndSampStatistic</code> : we have <span>$K$</span> groups and <span>$N=N_1+...+N_K$</span> total observations; <code>Y</code> is an <span>$M$</span>-vector, each one holding all observations for the <span>$m^{th}$</span> hypothesis in a single vector. The <span>$m^{th}$</span> vector <span>$y_m$</span> concatenates the observations for all groups such as [y[m][1];...;y[m][K]]. <code>x</code> is the <a href="#PermutationTests.membership"><code>membership(::IndSampStatistic)</code></a> vector, common to all hypotheses. For example, for <span>$K=2$</span>, <span>$N_1=2$</span> and <span>$N_2=3$</span>, <code>x=[1, 1, 2, 2, 2]</code>. </li><li><code>RepMeasStatistic</code> : we have <span>$K$</span> measures (<em>e.g.</em>, treatements) and <span>$N$</span> subjects; <code>Y</code> is an M-vector, each one holding the <span>$K*N$</span> observations for the <span>$m^{th}$</span> hypothesis in a single vector. The <span>$m^{th}$</span> vector <span>$y_m$</span> is such as <code>[Y[m][1];...;Y[m][N]]</code>, where each vector Y[1][n], for <span>$n=1…N$</span>, holds the observations for the <span>$K$</span> treatments and <code>x=collect(1:K*N)</code> (see <a href="#PermutationTests.membership"><code>membership(::RepMeasStatistic)</code></a>). </li><li><code>OneSampStatistic</code> : We have <span>$N$</span> observations (<em>e.g.</em>, subjects); <code>Y</code> is an <span>$M$</span>-vector, each one holding the <span>$N$</span> observations and <code>x=ones(Int, N)</code> (see <a href="#PermutationTests.membership"><code>membership(::OneSampStatistic)</code></a>).</li></ul><p>Optional keyword arguments <code>switch2rand</code>, <code>nperm</code>, <code>standardized</code>, <code>centered</code>, <code>seed</code>, <code>fstat</code>, <code>compfunc</code> and <code>verbose</code> have the same meaning as in the <a href="#PermutationTests._permTest!"><code>_permTest!</code></a> function.</p><p>If <code>threaded</code> is true (default) the function is multi-threaded if the product of the number of hypotheses,      observations, and permutations exceed 500 millions. If you have unexpected problems with the function, try setting <code>threaded</code> to false.</p><p>For the <code>cpcd</code> argument, see <a href="#Create-your-own-test">create you own test</a>.</p><p>Return a <a href="../PermutationTests/#MultcompTest">MultcompTest</a> structure.</p><p>The number of executed steps <span>$S$</span> can be retrived as the length of the <code>.rejections</code> field  of the returned structure. </p><p><em>Examples</em></p><pre><code class="language-julia hljs">using PermutationTests
N, M = 8, 100 # 100 hypotheses, N=8
x=randn(N)
Y=[randn(N) for m=1:M]
# bi-directional exact test of the correlation between x and 
# all the M vector in Y.
T12 = _permMcTest!(x, Y, N, PearsonR(), PearsonR())
T12.p
T12.stat
#...

# bi-directional exact test. Faster test by data standardization 
T12_2 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y in Y], N, CrossProd(), PearsonR(); 
                    standardized=true) 

# left-directional exact test.
T12_3 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y in Y], N, CrossProd(), PearsonR(); 
                    standardized=true, fstat=flip)

# as above, but force an approximate test
T12_4 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y in Y], N, CrossProd(), PearsonR(); 
                    standardized=true, fstat=flip, switch2rand=1)

# the same using 5000 random permutations
T12_4 = _permMcTest!(μ0σ1(x), [μ0σ1(y) for y in Y], N, CrossProd(), PearsonR(); 
                    standardized=true, fstat=flip, switch2rand=1, nperm=5000)</code></pre><p>To check more examples, see the <em>multcompTests_API.jl</em> unit located in the <em>src</em> github folder and function <code>test_multicompTests()</code> in the <em>runtests.jl</em> unit located in the <em>test</em> github folder.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/multcompTests.jl#L117-L218">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests.flip" href="#PermutationTests.flip"><code>PermutationTests.flip</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">flip(x::Bool)

flip(x::Union{R, I}) where {R&lt;:Real, I&lt;:Int}</code></pre><p>Invert the sign of a real number or integer and negate a boolean. </p><p>This function is be needed only to call <a href="#PermutationTests._permTest!"><code>_permTest!</code></a> or <a href="#PermutationTests._permMcTest!"><code>_permMcTest!</code></a> if you  <a href="#Create-your-own-test">create your own test</a>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/tools.jl#L38-L49">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests.membership" href="#PermutationTests.membership"><code>PermutationTests.membership</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function membership(stat::IndSampStatistic, ns::Vector{Int})</code></pre><p>Create the appropriate argument <code>x</code> to be used by functions <a href="#PermutationTests._permTest!"><code>_permTest!</code></a> and <a href="#PermutationTests._permMcTest!"><code>_permMcTest!</code></a> when you  <a href="#Create-your-own-test">create your own test</a> using the permutation scheme of test statistics belonging  to the <code>IndSampStatistic</code> <a href="../PermutationTests/#Statistic-groups">group</a>.</p><p>For <code>stat</code> a <code>IndSampStatistic</code>, <code>ns</code> is a group numerosity vector, <em>i.e.</em>, a vector of positive integers  <code>[N1,...,NK]</code>, where <span>$K$</span> is the number of groups and <span>$N_k$</span> is the number of observations for the <span>$k^{th}$</span> group (see <a href="../tools/#ns">ns</a>).  </p><p>Return the group membership vector <code>[repeat (1, N1);...; repeat(K, Nk)]</code></p><p>If <code>rev=reverse</code> is passed as keyword argument, return instead group membership vector <code>[repeat (K, N1);...; repeat(1, Nk)]</code>. This is used to run t-tests for independent samples using the <code>PearsonR()</code> <a href="../PermutationTests/#Statistic">Statistic</a>, see for example <a href="../univariate tests/#PermutationTests.studentTestIS"><code>studentTestIS</code></a>.</p><p><em>Examples</em></p><pre><code class="language-julia hljs">using PermutationsTests
membership(AnovaF_IS(), [3, 4])
# return the vector [1, 1, 1, 2, 2, 2, 2]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/tools.jl#L307-L331">source</a></section><section><div><pre><code class="language-julia hljs">function membership(stat::RepMeasStatistic, ns::@NamedTuple{n::Int, k::Int})</code></pre><p>Create the appropriate argument <code>x</code> to be used by functions <a href="#PermutationTests._permTest!"><code>_permTest!</code></a> and <a href="#PermutationTests._permMcTest!"><code>_permMcTest!</code></a> when you  <a href="#Create-your-own-test">create your own test</a> using the permutation scheme of test statistics belonging  to the <code>RepMeasStatistic</code> <a href="../PermutationTests/#Statistic-groups">group</a>.</p><p>For <code>stat</code> a <code>RepMeasStatistic</code>, <code>ns</code> is a named tuple, such as <code>(n=N, k=K)</code>, where <span>$N$</span> is the number of observations (e.g., <em>subjects</em>) and <span>$K$</span> the number of measurements (or <em>treatments</em>, <em>times</em>, ect.), see <a href="../tools/#ns">ns</a>.</p><p>Return <code>collect(1:N*K)</code>.</p><p><em>Examples</em></p><pre><code class="language-julia hljs">using PermutationsTests
membership(AnovaF_RM(), (n=2, k=4))
# return the vector [1, 2, 3, 4, 5, 6, 7, 8]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/tools.jl#L335-L354">source</a></section><section><div><pre><code class="language-julia hljs">function membership(stat::OneSampStatistic, ns::Int)</code></pre><p>Create the appropriate argument <code>x</code> to be used by functions <a href="#PermutationTests._permTest!"><code>_permTest!</code></a> and <a href="#PermutationTests._permMcTest!"><code>_permMcTest!</code></a> when you  <a href="#Create-your-own-test">create your own test</a> using the permutation scheme of test statistics belonging  to the <code>OneSampStatistic</code> <a href="../PermutationTests/#Statistic-groups">group</a>.</p><p>For <code>stat</code> a <code>OneSampStatistic</code>, <code>ns</code> is the number of observations (e.,g., <em>subjects</em>) given as an integer, see <a href="../tools/#ns">ns</a>.</p><p>Return <code>ones(Int, ns)</code>.</p><p><em>Examples</em></p><pre><code class="language-julia hljs">using PermutationsTests
membership(Sum(), 5)
# return the vector [1, 1, 1, 1, 1]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/tools.jl#L357-L376">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests._observedStats" href="#PermutationTests._observedStats"><code>PermutationTests._observedStats</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function _observedStats(x, Y::UniDataVec, stat::statistic, fstat; pcd=nothing, kwargs...)
                        where statistic&lt;:Statistic </code></pre><p>Compute obseved statistics for multiple comparisons permutation tests.</p><p>If you <a href="#Create-your-own-test">create your own test</a> you will write a method taking as <code>stat</code> a test statistic of type <a href="../PermutationTests/#Statistic">Statistic</a> you have declared.</p><p>If not, you never need this function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/multcompTests.jl#L32-L44">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests._permutedStat" href="#PermutationTests._permutedStat"><code>PermutationTests._permutedStat</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function _permutedStat(x, Y::UniDataVec, i::Int, stat::AnovaF_RM, fstat; pcd=nothing, kwargs...) </code></pre><p>Compute the <span>$i^{th}$</span> permuted statistics for the <span>$i^{th}$</span> hypothesis, with <span>$i=1...M$</span>, for multiple comparisons permutation tests.</p><p>If you <a href="#Create-your-own-test">create your own test</a> you will write a method taking as <code>stat</code> a test statistic of type <a href="../PermutationTests/#Statistic">Statistic</a> you have declared.</p><p>If not, you never need this function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/multcompTests.jl#L57-L69">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests._∑y²" href="#PermutationTests._∑y²"><code>PermutationTests._∑y²</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function _∑Y²(y)</code></pre><p>Pre-compute some data for the <a href="../test statistics/#PermutationTests.statistic"><code>statistic</code></a> methods computing the <code>StudentT_1S</code> test-statistic and the <code>AnovaF_RM</code> test-statistic.</p><p>Return the sum of all squared observations in <code>y</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/stats.jl#L673-L683">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PermutationTests._∑Y²kn_∑y²_∑S²k" href="#PermutationTests._∑Y²kn_∑y²_∑S²k"><code>PermutationTests._∑Y²kn_∑y²_∑S²k</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function _∑Y²kn_∑y²_∑S²k(y, ns)</code></pre><p>Pre-compute some data for the <a href="../test statistics/#PermutationTests.statistic"><code>statistic</code></a> computing the <code>AnovaF_RM</code> test-statistic.</p><p>Return a 3-tuple.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Marco-Congedo/PermutationTests.jl/blob/691306e540034a9cd13f28344090782651c0a18f/src/stats.jl#L690-L698">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../test statistics/">« Test statistics</a><a class="docs-footer-nextpage" href="../chose a test/">Chose a Test »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Sunday 30 June 2024 17:14">Sunday 30 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
